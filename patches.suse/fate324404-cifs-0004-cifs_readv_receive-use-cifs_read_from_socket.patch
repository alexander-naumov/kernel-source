From a6137305a8c47fa92ab1a8efcfe76f0e9fa96ab7 Mon Sep 17 00:00:00 2001
From: Al Viro <viro@zeniv.linux.org.uk>
Date: Sat, 9 Jan 2016 19:37:16 -0500
Subject: [PATCH] cifs_readv_receive: use cifs_read_from_socket()
Patch-mainline: v4.7-rc1
Git-commit: a6137305a8c47fa92ab1a8efcfe76f0e9fa96ab7
References: fate#322075, fate#324404, bsc#1071009

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Acked-by: David Mulder <dmulder@suse.com>
Acked-by: Aurelien Aptel <aaptel@suse.com>

---
 fs/cifs/cifssmb.c | 11 ++++-------
 1 file changed, 4 insertions(+), 7 deletions(-)

diff --git a/fs/cifs/cifssmb.c b/fs/cifs/cifssmb.c
--- a/fs/cifs/cifssmb.c
+++ b/fs/cifs/cifssmb.c
@@ -1449,10 +1449,8 @@ cifs_readv_receive(struct TCP_Server_Inf
 	len = min_t(unsigned int, buflen, server->vals->read_rsp_size) -
 							HEADER_SIZE(server) + 1;
 
-	rdata->iov.iov_base = buf + HEADER_SIZE(server) - 1;
-	rdata->iov.iov_len = len;
-
-	length = cifs_readv_from_socket(server, &rdata->iov, 1, len);
+	length = cifs_read_from_socket(server,
+				       buf + HEADER_SIZE(server) - 1, len);
 	if (length < 0)
 		return length;
 	server->total_read += length;
@@ -1504,9 +1502,8 @@ cifs_readv_receive(struct TCP_Server_Inf
 	len = data_offset - server->total_read;
 	if (len > 0) {
 		/* read any junk before data into the rest of smallbuf */
-		rdata->iov.iov_base = buf + server->total_read;
-		rdata->iov.iov_len = len;
-		length = cifs_readv_from_socket(server, &rdata->iov, 1, len);
+		length = cifs_read_from_socket(server,
+					       buf + server->total_read, len);
 		if (length < 0)
 			return length;
 		server->total_read += length;
